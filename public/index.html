<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            color: #333;
        }

        .navbar {
            background: linear-gradient(135deg, #003580 0%, #002456 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar h2 {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .nav-links {
            display: flex;
            gap: 25px;
        }

        .nav-links span {
            cursor: pointer;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .nav-links span:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .container {
            max-width: 1000px;
            margin: 30px auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h3 {
            color: #003580;
            margin-bottom: 20px;
            font-size: 28px;
            border-bottom: 3px solid #003580;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #003580;
            box-shadow: 0 0 8px rgba(0, 53, 128, 0.2);
        }

        button {
            background: linear-gradient(135deg, #003580 0%, #002456 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 10px 10px 10px 0;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 53, 128, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(135deg, #666 0%, #444 100%);
        }

        button.secondary:hover {
            box-shadow: 0 4px 12px rgba(100, 100, 100, 0.3);
        }

        button.success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
        }

        button.success:hover {
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        button.danger {
            background: linear-gradient(135deg, #dc3545 0%, #bb2d3b 100%);
        }

        button.danger:hover {
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .flight-card {
            border: 2px solid #e0e0e0;
            padding: 18px;
            margin-bottom: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            background-color: #f9fafb;
        }

        .flight-card:hover {
            border-color: #003580;
            background-color: #f0f4f8;
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 53, 128, 0.15);
        }

        .flight-info {
            flex-grow: 1;
        }

        .flight-info strong {
            color: #003580;
            font-size: 16px;
        }

        .flight-info p {
            margin: 5px 0;
            color: #666;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            display: inline-block;
            margin: 5px 0;
        }

        .status-confirmed {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .boarding-pass {
            border: 3px dashed #003580;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            margin-top: 25px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
        }

        .boarding-pass h4 {
            text-align: center;
            color: #003580;
            font-size: 18px;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        .boarding-pass p {
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dotted #ccc;
        }

        .qr-code-display {
            background: black;
            color: white;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
            border-radius: 4px;
            font-weight: bold;
            letter-spacing: 2px;
            font-size: 12px;
        }

        .booking-details {
            margin-top: 25px;
            padding: 20px;
            border-top: 2px solid #e0e0e0;
            background-color: #fafbfc;
            border-radius: 8px;
        }

        .booking-details h4 {
            color: #003580;
            margin-bottom: 15px;
        }

        .booking-details p {
            margin: 10px 0;
            color: #555;
        }

        .info-box {
            background-color: #e7f3ff;
            border-left: 4px solid #003580;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            color: #003580;
        }

        .success-box {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            color: #155724;
        }

        .error-box {
            background-color: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            color: #721c24;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #003580;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .confirmation-message {
            text-align: center;
            padding: 40px;
        }

        .confirmation-message h3 {
            font-size: 32px;
            color: #28a745;
        }

        .pnr-display {
            background: linear-gradient(135deg, #003580 0%, #002456 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            margin: 25px 0;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 2px;
            box-shadow: 0 4px 15px rgba(0, 53, 128, 0.3);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }

            .nav-links {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }

            .nav-links span {
                width: 100%;
                text-align: center;
            }

            .container {
                margin: 15px;
                padding: 15px;
            }

            .flight-card {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            button {
                width: 100%;
            }

            .button-group {
                flex-direction: column;
            }

            .button-group button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <div class="navbar">
        <h2>‚úàÔ∏è FMS Airline</h2>
        <div class="nav-links">
            <span onclick="showSection('search-section')">üîç Book Flight</span>
            <span onclick="showSection('checkin-section')">üìù Check-In / Manage</span>
            <span onclick="showSection('support-section')">üÜò Support</span>
        </div>
    </div>

    <div class="container">
        
        <!-- 1. SEARCH FLIGHTS -->
        <div id="search-section" class="section active">
            <h3>‚úàÔ∏è Find Your Flight</h3>
            <div class="info-box">
                üí° <strong>Tip:</strong> Try searching NYC ‚Üí LON on 2025-10-15
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="origin">Origin City</label>
                    <input type="text" id="origin" placeholder="e.g., NYC" value="NYC">
                </div>
                <div class="form-group">
                    <label for="destination">Destination City</label>
                    <input type="text" id="destination" placeholder="e.g., LON" value="LON">
                </div>
                <div class="form-group">
                    <label for="date">Travel Date</label>
                    <input type="date" id="date" value="2025-10-15">
                </div>
            </div>
            <button onclick="searchFlights()">üîç Search Flights</button>
            <div id="flight-results" style="margin-top: 25px;"></div>
        </div>

        <!-- 2. PASSENGER DETAILS -->
        <div id="passenger-section" class="section">
            <h3>üë§ Passenger Details</h3>
            <div id="selected-flight-info" class="info-box" style="margin-bottom: 20px;"></div>
            
            <div class="form-group">
                <label for="p-name">Full Name</label>
                <input type="text" id="p-name" placeholder="John Doe">
            </div>
            <div class="form-group">
                <label for="p-email">Email Address</label>
                <input type="email" id="p-email" placeholder="john@example.com">
            </div>
            <div class="form-group">
                <label for="p-passport">Passport Number</label>
                <input type="text" id="p-passport" placeholder="A123456789">
            </div>
            
            <div class="button-group">
                <button class="success" onclick="createBooking()">‚úì Proceed to Payment</button>
                <button class="secondary" onclick="showSection('search-section')">‚Üê Back</button>
            </div>
        </div>

        <!-- 3. PAYMENT -->
        <div id="payment-section" class="section">
            <h3>üí≥ Payment Gateway</h3>
            <div class="info-box">
                <strong>Total Amount:</strong> <span id="pay-amount" style="font-size: 20px; font-weight: bold;"></span>
            </div>
            
            <div class="form-group">
                <label for="card-number">Card Number (Mock)</label>
                <input type="text" id="card-number" placeholder="1234-5678-9012-3456" value="1234-5678-9012-3456">
            </div>
            <div class="form-group">
                <label for="card-cvv">CVV</label>
                <input type="text" id="card-cvv" placeholder="123" style="max-width: 150px;" value="123">
            </div>
            
            <div class="button-group">
                <button class="success" onclick="processPayment()">üí∞ Pay & Confirm</button>
                <button class="secondary" onclick="showSection('passenger-section')">‚Üê Back</button>
            </div>
        </div>

        <!-- 4. CONFIRMATION -->
        <div id="confirmation-section" class="section">
            <div class="confirmation-message">
                <h3>‚úÖ Booking Confirmed!</h3>
                <p style="font-size: 18px; margin: 20px 0;">Your reservation has been successfully created.</p>
                <div class="pnr-display">
                    PNR: <span id="conf-pnr"></span>
                </div>
                <p style="color: #666; margin-bottom: 25px;">üìß A confirmation email has been sent to your registered email address.</p>
                <p style="color: #666; font-size: 14px; margin-bottom: 25px;">üí° <strong>Save your PNR!</strong> You'll need it for check-in and other operations.</p>
                
                <div class="button-group" style="justify-content: center;">
                    <button class="success" onclick="showSection('checkin-section')">Proceed to Check-In ‚Üí</button>
                    <button class="secondary" onclick="showSection('search-section')">‚Üê Search Again</button>
                </div>
            </div>
        </div>

        <!-- 5. CHECK-IN & MANAGE -->
        <div id="checkin-section" class="section">
            <h3>üìù My Trips & Check-In</h3>
            <div class="info-box">
                üëâ Enter your PNR and Passport to view or manage your booking
            </div>
            
            <div class="form-group">
                <label for="manage-pnr">Booking Reference (PNR)</label>
                <input type="text" id="manage-pnr" placeholder="e.g., PNR123456">
            </div>
            <div class="form-group">
                <label for="manage-passport">Passport Number</label>
                <input type="text" id="manage-passport" placeholder="Required for validation">
            </div>
            
            <button onclick="fetchBooking()">üîç Find Booking</button>
            
            <div id="booking-details" class="booking-details" style="display:none;">
                <h4>‚úàÔ∏è Flight Details</h4>
                <p><strong>Route:</strong> <span id="bd-route"></span></p>
                <p><strong>Flight:</strong> <span id="bd-flight"></span> | <strong>Date:</strong> <span id="bd-date"></span></p>
                <p><strong>Status:</strong> <span id="bd-status" class="status-badge"></span></p>
                
                <div id="action-buttons" class="button-group" style="margin-top: 20px;">
                    <button id="btn-checkin" class="success" onclick="performCheckIn()" style="display:none;">‚úì Check In Now</button>
                    <button id="btn-cancel" class="danger" onclick="cancelBooking()" style="display:none;">‚úó Cancel & Refund</button>
                </div>
                
                <div id="boarding-pass-display" class="boarding-pass" style="display:none; margin-top: 25px;">
                    <h4>BOARDING PASS</h4>
                    <p>
                        <strong>Passenger:</strong>
                        <span id="bp-name"></span>
                    </p>
                    <p>
                        <strong>Flight:</strong>
                        <span id="bp-flight"></span>
                    </p>
                    <p>
                        <strong>Seat:</strong>
                        <span id="bp-seat"></span>
                    </p>
                    <p>
                        <strong>Gate:</strong>
                        <span id="bp-gate"></span>
                    </p>
                    <p>
                        <strong>Boarding Time:</strong>
                        <span id="bp-boarding"></span>
                    </p>
                    <div class="qr-code-display">[ QR CODE SIMULATION ]</div>
                </div>
            </div>
        </div>

        <!-- 6. SUPPORT -->
        <div id="support-section" class="section">
            <h3>üÜò Customer Support</h3>
            <div class="info-box">
                We're here to help! Submit your issue and we'll get back to you shortly.
            </div>
            
            <div class="form-group">
                <label for="support-pnr">Related PNR (Optional)</label>
                <input type="text" id="support-pnr" placeholder="If your issue is related to a booking">
            </div>
            <div class="form-group">
                <label for="support-type">Issue Type</label>
                <select id="support-type">
                    <option value="Refund">üí∞ Refund Request</option>
                    <option value="Baggage">üì¶ Lost Baggage</option>
                    <option value="Change">üìù Flight Change</option>
                    <option value="Complaint">‚ö†Ô∏è Complaint</option>
                    <option value="Other">‚ùì General Inquiry</option>
                </select>
            </div>
            <div class="form-group">
                <label for="support-details">Describe Your Issue</label>
                <textarea id="support-details" placeholder="Please provide details about your issue..."></textarea>
            </div>
            
            <button class="success" onclick="submitSupport()">üì§ Submit Support Ticket</button>
        </div>

    </div>

    <script>
        // --- FRONTEND LOGIC (Simulates UI Controller) ---
        
        let currentFlight = null;
        let currentPnr = null;

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            const section = document.getElementById(id);
            if (section) {
                section.classList.add('active');
                // Scroll to top
                window.scrollTo(0, 0);
            }
        }

        async function searchFlights() {
            const origin = document.getElementById('origin').value.trim();
            const dest = document.getElementById('destination').value.trim();
            const date = document.getElementById('date').value;

            if (!origin || !dest || !date) {
                alert('Please fill in all search fields');
                return;
            }

            try {
                const res = await fetch(`/api/flights?origin=${origin}&destination=${dest}&date=${date}`);
                const flights = await res.json();

                const container = document.getElementById('flight-results');
                container.innerHTML = '';

                if(flights.length === 0) {
                    container.innerHTML = '<div class="error-box">‚ùå No flights found. Try NYC ‚Üí LON on 2025-10-15</div>';
                    return;
                }

                flights.forEach(f => {
                    const div = document.createElement('div');
                    div.className = 'flight-card';
                    div.innerHTML = `
                        <div class="flight-info">
                            <strong>${f.flightId}</strong>: ${f.origin} ‚Üí ${f.destination}<br>
                            <p>üïê Time: ${f.time} | üí∫ Seats Available: ${f.seats} | üíµ Price: <strong>$${f.price}</strong></p>
                        </div>
                        <button class="success" style="width: auto; min-width: 150px;" onclick='selectFlight(${JSON.stringify(f)})'>Select Flight</button>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                console.error('Error:', error);
                alert('Error searching flights. Check console.');
            }
        }

        function selectFlight(flight) {
            currentFlight = flight;
            document.getElementById('selected-flight-info').innerHTML = `
                <strong>‚úÖ Selected Flight:</strong> ${flight.flightId} | 
                <strong>${flight.origin} ‚Üí ${flight.destination}</strong> | 
                <strong>$${flight.price}</strong>
            `;
            showSection('passenger-section');
        }

        async function createBooking() {
            const passengerName = document.getElementById('p-name').value.trim();
            const email = document.getElementById('p-email').value.trim();
            const passport = document.getElementById('p-passport').value.trim();

            if (!passengerName || !email || !passport) {
                alert('Please fill in all passenger details');
                return;
            }

            try {
                const res = await fetch('/api/booking', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ flightId: currentFlight.flightId, passengerName, email, passport })
                });

                if (!res.ok) {
                    const error = await res.json();
                    alert('Error: ' + error.message);
                    return;
                }

                const booking = await res.json();
                currentPnr = booking.pnr;
                document.getElementById('pay-amount').innerText = '$' + booking.totalPrice;
                showSection('payment-section');
            } catch (error) {
                console.error('Error:', error);
                alert('Error creating booking. Check console.');
            }
        }

        async function processPayment() {
            const cardNumber = document.getElementById('card-number').value.trim();
            
            if (!cardNumber || cardNumber.length < 10) {
                alert('Please enter a valid card number');
                return;
            }

            try {
                const res = await fetch('/api/payment', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ pnr: currentPnr, cardNumber })
                });

                if (!res.ok) {
                    const error = await res.json();
                    alert('Payment Error: ' + error.message);
                    return;
                }

                document.getElementById('conf-pnr').innerText = currentPnr;
                showSection('confirmation-section');
            } catch (error) {
                console.error('Error:', error);
                alert('Error processing payment. Check console.');
            }
        }

        async function fetchBooking() {
            const pnr = document.getElementById('manage-pnr').value.trim();
            const passport = document.getElementById('manage-passport').value.trim();

            if (!pnr || !passport) {
                alert('Please enter both PNR and Passport');
                return;
            }

            currentPnr = pnr;
            
            try {
                const res = await fetch(`/api/booking/${pnr}`);
                
                if(!res.ok) {
                    alert('‚ùå Booking not found. Check your PNR.');
                    return;
                }

                const booking = await res.json();
                document.getElementById('booking-details').style.display = 'block';
                document.getElementById('bd-route').innerText = `${booking.flightDetails.origin} ‚Üí ${booking.flightDetails.destination}`;
                document.getElementById('bd-flight').innerText = booking.flightId;
                document.getElementById('bd-date').innerText = booking.flightDetails.date;
                
                const statusBadge = document.getElementById('bd-status');
                statusBadge.innerText = booking.status;
                statusBadge.className = 'status-badge';
                
                if (booking.status === 'CONFIRMED') {
                    statusBadge.classList.add('status-confirmed');
                } else if (booking.status === 'PENDING_PAYMENT') {
                    statusBadge.classList.add('status-pending');
                } else if (booking.status === 'CANCELLED') {
                    statusBadge.classList.add('status-cancelled');
                }

                const btnCheckin = document.getElementById('btn-checkin');
                const btnCancel = document.getElementById('btn-cancel');
                
                if(booking.status === 'CONFIRMED' && !booking.checkedIn) {
                    btnCheckin.style.display = 'block';
                    btnCancel.style.display = 'block';
                } else {
                    btnCheckin.style.display = 'none';
                    btnCancel.style.display = 'none';
                }

                if(booking.checkedIn) {
                    document.getElementById('boarding-pass-display').style.display = 'block';
                    document.getElementById('bp-name').innerText = booking.passenger.passengerName;
                    document.getElementById('bp-flight').innerText = booking.flightId;
                    document.getElementById('bp-seat').innerText = "12A"; 
                    document.getElementById('bp-gate').innerText = "B4";
                    document.getElementById('bp-boarding').innerText = "09:30";
                } else {
                    document.getElementById('boarding-pass-display').style.display = 'none';
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error fetching booking. Check console.');
            }
        }

        async function performCheckIn() {
            const passport = document.getElementById('manage-passport').value.trim();
            
            if (!passport) {
                alert('Passport is required for check-in');
                return;
            }

            try {
                const res = await fetch('/api/checkin', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ pnr: currentPnr, passport })
                });

                if(!res.ok) {
                    const error = await res.json();
                    alert('Check-in Error: ' + error.message);
                    return;
                }

                alert('‚úÖ Check-in Successful! Your boarding pass is ready.');
                fetchBooking();
            } catch (error) {
                console.error('Error:', error);
                alert('Error performing check-in. Check console.');
            }
        }

        async function cancelBooking() {
            if(!confirm("Are you sure you want to cancel this booking and request a refund?")) return;

            try {
                const res = await fetch('/api/cancel', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ pnr: currentPnr })
                });

                if(!res.ok) {
                    alert('Cancellation failed');
                    return;
                }

                alert("‚úÖ Booking Cancelled. Refund has been initiated and will be processed within 5-7 business days.");
                fetchBooking();
            } catch (error) {
                console.error('Error:', error);
                alert('Error cancelling booking. Check console.');
            }
        }

        async function submitSupport() {
            const pnr = document.getElementById('support-pnr').value.trim();
            const issueType = document.getElementById('support-type').value;
            const details = document.getElementById('support-details').value.trim();

            if (!details) {
                alert('Please describe your issue');
                return;
            }

            try {
                const res = await fetch('/api/support', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ pnr, issueType, details })
                });

                if (!res.ok) {
                    alert('Error submitting support ticket');
                    return;
                }

                const data = await res.json();
                alert(`‚úÖ Support Ticket Created!\n\nTicket ID: ${data.ticketId}\n\nWe'll get back to you shortly.`);
                
                // Clear the form
                document.getElementById('support-pnr').value = '';
                document.getElementById('support-details').value = '';
                document.getElementById('support-type').value = 'Refund';
            } catch (error) {
                console.error('Error:', error);
                alert('Error submitting support ticket. Check console.');
            }
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            console.log('‚úàÔ∏è Flight Management System loaded successfully');
        });
    </script>
</body>
</html>
